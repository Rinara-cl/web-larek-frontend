# Проектная работа "Веб-ларек"
Проектная работа "Веб-ларек" представляет из себя интернет-магазин для веб-разработчиков. Приложение реализует католог товаров, а также позволяет добовлять товары в корзину и совершать покупки.

# Описание
Проект реализован согласно принципу MVP (Model-View-Presenter), обеспечивающему чёткую границу ответственности между классами Model и View, где 
- Model занимается обработкой загрузки данных через API, хранением и управлением информацией, полученной от пользователя,
- View отвечает за визуализацию интерфейса, взаимодействие с пользователем и отправляет уведомления о происходящих событиях.
- EventEmitter, выполняя роль Presenter-а, связывает модели данных с представлениями, координируя обмен данными и действиями между компонентами при наступлении событий.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

# Описание базовых классов

**Базовый класс Api**

В этом классе реализован набор операций для взаимодействия с сервером. HTTP методы типизированы как: 

type ApiPostMethods = 'POST' | 'PUT' | 'DELETE';


**Базовый класс EventEmitter**

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события. Данный класс реализует интерфейс IEvents.
Класс имеет методы on ,  off ,  emit  — для подписки на событие, отписки от события и уведомления
подписчиков о наступлении события соответственно.
Дополнительно реализованы методы  onAll и  offAll  — для подписки на все события и сброса всех
подписчиков.
Интересным дополнением является метод  trigger , генерирующий заданное событие с заданными
аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти
классы будут генерировать события, не будучи при этом напрямую зависимыми от
класса  EventEmitter.

Описание данных
Данные, используемые в проекте, представлены интерфейсами IProduct и IOrder.

**Интерфейс IProductView**

Интерфейс описывает структуру объекта, представляющего собой единичный товар в онлайн-каталоге магазина. Объект содержит всю необходимую информацию для представления товара покупателю.

Свойства:

`id`: Уникальный идентификатор товара, задаётся строковым значением.
`category`: Категория, к которой относится товар, указана строкой.
`title`: Название товара, представленное текстом.
`description`: Детальное описание характеристик и особенностей товара, заданное строкой.
`image`: URL-изображения товара, использующегося для визуализации в каталоге.
`price`: Цена товара, числовое значение либо `null`, если цена временно неизвестна.
`cartPresence` *(необязательно)*: Булевое значение, определяющее, находится ли товар в корзине покупателя.
`cartItemIndex` *(необязательно)*: Индекс позиции товара в списке корзины.

**Интерфейс IOrder**

Интерфейс представляет собой структуру объекта заказа, отправляемого на сервер. Содержит перечень товаров, включённых в заказ, а также персональные данные клиента и общую сумму покупки.

Свойства:

- `payment`: Способ оплаты, указанный строкой.
- `email`: Электронная почта заказчика, представленная строкой.
- `phone`: Номер телефона заказчика, указывается строкой.
- `address`: Адрес доставки, обозначенный строкой.
- `total`: Общая сумма заказа, выраженная числом.
- `items`: Список идентификаторов товаров (массив строк), входящих в состав заказа.


# Слой данных

*Базовая модель (Model)* 
Абстрактный класс, предназначенный для предоставления базовой функциональности всем производным моделям приложения. Основной задачей класса является хранение данных и обеспечение возможности уведомления о событиях через интерфейс событий (`IEvents`).

Конструктор принимает начальные данные и ссылку на объект событий, позволяющий другим объектам подписываться на изменения в модели.
Метод `emitChanges` обеспечивает отправку событий внешним слушателям вместе с дополнительной информацией.


*Модальное окно (ModalData)*  
Компонент для отображения модальных окон на веб-странице. Наследуется от общего класса компонентов (`Component`). Ответственен за открытие, закрытие и обновление содержимого модальных окон.

Свойства:
`_closeButton`: Кнопка закрытия модального окна.
`_content`: Контейнер для основного содержимого окна.

Методы:
`set content(value: HTMLElement)`: Устанавливает новое содержимое окна, заменяя предыдущее.
 `open()`: Открывает модальное окно, выставляя соответствующий класс активного состояния и генерирует событие открытия.
`close()`: Закрывает модальное окно, удаляя активный класс и очищает контент, отправляя событие закрытия.

В конструкторе настраиваются элементы интерфейса и устанавливаются обработчики событий для закрытия окна (при клике на кнопку или фон окна), а также предотвращается распространение событий кликнувшего элемента внутрь модального окна.


**Класс Component**

Абстрактный класс, служащий основой для всех компонентов представления. Предоставляет базовые инструменты для взаимодействия с DOM. Конструктор принимает корневой HTML-элемент, который станет контейнером компонента.

Основные методы:

toggleClass(element: HTMLElement, className: string, force?: boolean) — управляет наличием указанного класса у элемента.
setText(element: HTMLElement, value: unknown) — заменяет текстовое содержание элемента.
setDisabled(element: HTMLElement, state: boolean) — отключает или активирует элемент.
setHidden(element: HTMLElement) — прячет элемент.
setVisible(element: HTMLElement) — отображает скрытый элемент.
setImage(element: HTMLImageElement, src: string, alt?: string) — загружает изображение в элемент и устанавливает альтернативный текст.
render(data?: Partial<T>) — отображает переданные данные на экране.

**Класс AppState**

Содержит основную логику работы с данными в приложении. Хранит массив товаров каталога, массив товаров корзины, данные заказа. Содержит все методы изменяющие данные в приложении.

Поля:
catalog: IProductView[] - массив товаров каталога
shoppingCart: IProductView[] - массив товаров в корзине
order: PaymentForm & ContactForm - данные покупателя, введенные в формы заказа
preview: string | null - ID выведенного в модальное окно товара
formErrors: FormErrors - объект ошибок валидации

Методы:
setCatalog(items: IProductView[]) - позволяет установить каталог товаров
setPreview(item: IProductView) - сохраняет id выбранной карточки
addToBasket(item: IProductView) - добавление товара в корзину
removeFromBasket(item: IProductView) - удаление товара из корзины
countBasket() - получение количества товаров добавленных в корзину
getTotal() - получение итоговой суммы заказа
clearBasket() - очистка корзины после завершения заказа
clearOrder() - очистка полей форм после завершения заказа
setPaymentField(field: keyof IPaymentForm, value: string) - сохранение данных из поля ввода
setContactField(field: keyof IContactForm, value: string) - сохранение данных из поля ввода
validatePayment() - валидация полей ввода
validateContact() - валидация полей ввода

**Класс Product**

Наследуется от абстрактного класса `Component`. Предназначен для отображения отдельных карточек товаров. Формирует карточку с изображением, названием, ценой, категорией и описанием товара. Реализует сеттеры и геттеры для гибкого управления полями.

В конструктор передается название компонента, основной контейнер для вставки карточки и колбэк, который исполняется при клике на кнопку карточки.

Основные поля:
`title: HTMLElement` — элемент с названием товара.
`image: HTMLImageElement` — изображение товара.
`category: HTMLElement` — категория товара.
`price: HTMLElement` — цена товара.
`description: HTMLElement` — описание товара.
`button: HTMLButtonElement` — кнопка добавления товара в корзину.
`cartItemIndex?: HTMLElement` — порядковый номер товара в корзине (опционально).

Методы:
`changeButtonDescription(inCart: boolean)` — изменяет подпись на кнопке карточки товара в зависимости от статуса нахождения товара в корзине.

**Класс Page**

Производный от абстрактного класса `Component`. Управляет расположением и выводом элементов на странице, распределяя компоненты по соответствующим контейнерам. Отвечает за подсчёт количества товаров в корзине и возможность блокировки скроллинга страницы при появлении модального окна. Содержит ряд сеттеров для удобства работы с полями.

Конструктор принимает HTML-элемент основного контейнера и экземпляр класса `EventEmitter` для инициации событий.

Основные поля:
`counter: HTMLElement` — счётчик количества товаров в корзине.
`catalog: HTMLElement` — контейнер каталога товаров.
`wrapper: HTMLElement` — общий контейнер страницы (используется для блокировки скроллинга).
`shoppingCartIcon: HTMLElement` — индикатор корзины на главной странице.

**Класс Basket**
Наследуется от класса `Component`. Осуществляет визуализацию корзины и её содержимого.

Конструктор принимает HTML-элемент основного контейнера и экземпляр класса `EventEmitter` для регистрации событий.

Основные поля:
`list: HTMLElement` — контейнер для отображения товаров.
`total: HTMLElement` — элемент для вывода общей суммы корзины.
`button: HTMLButtonElement` — кнопка подтверждения заказа.

Методы:
 `resetCartView()` — очищает корзину, удаляя все отображённые ранее карточки товаров после завершения заказа.


**Класс Form**
Родительский класс для всех форм приложения, обеспечивающий универсальность и общие методы для работы с формами. Хранит и реализует сеттеры для присвоения значений полям формы.

Конструктор принимает HTML-элемент формы и экземпляр класса `EventEmitter` для передачи событий.

Основные поля:
`submit: HTMLButtonElement` — кнопка отправки формы.
`errors: HTMLElement` — область для отображения сообщений об ошибках валидации.

Методы:
`onInputChange()` — следит за изменениями в полях формы и инициирует соответствующее событие.
`render(state: Partial<T> & IFormState)` — осуществляет визуализацию формы и её повторное отображение (например, при возникновении ошибок валидации).


**Класс Payment**
Наследуется от класса `Form`. Предназначен для визуализации формы выбора способа оплаты и указания адреса доставки. Реализует сеттеры для изменения полей формы.

Конструктор принимает HTML-элемент формы и экземпляр класса `EventEmitter` для трансляции событий.

Основные поля:
`payment: HTMLButtonElement[]` — массив кнопок для выбора способа оплаты.
`address: string` — адрес доставки.


**Класс Contact**
Наследуется от абстрактного класса `Form`, предназначен для отображения формы ввода контактных данных пользователя (телефон и email). Используется для сбора контактной информации при оформлении заказа.

-Конструктор принимает HTML-элемент формы и экземпляр класса `EventEmitter` для регистрации событий.

Реализованные методы позволяют устанавливать значения полей формы:

`set email(value: string)` — устанавливает значение поля ввода электронной почты (`input[name=email]`).
`set phone(value: string)` — устанавливает значение поля ввода номера телефона (`input[name=phone]`).

Пример использования:

```typescript
// Установка данных в форму
contactsForm.email = 'example@example.com';
contactsForm.phone = '+79876543210';
```

Данный класс служит шаблоном для отображения формы контактов и позволяет легко изменять значения полей формы извне.

**Класс Success**
Наследуется от класса `Component`. Применяется для демонстрации сообщения об успешной покупке в модальном окне, включая финальную сумму заказа.

Конструктор принимает HTML-элемент, куда выводится сообщение, и функцию, выполняемую при завершении заказа. Имеет сеттер `total` для задания суммы списания.

Основные поля:
`close: HTMLButtonElement` — кнопка для завершения заказа.
`total: HTMLElement` — отображаемая сумма потраченных средств.


# Слой коммуникации

**Класс SpecialAPI**
Расширяет функциональность базового API для упрощённого взаимодействия с сервером. Конструктор принимает URL для загрузки изображений, базовый URL и конфигурационные настройки.

Основные методы:
`getProductList: () => Promise<IProductView[]>` — получение списка товаров с сервера.
`getProductItem: (id: string) => Promise<IProductView>` — получение конкретного товара по его идентификатору.
`orderProducts: (order: IOrder) => Promise<IBasket>` — отправка заказа на сервер.

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
